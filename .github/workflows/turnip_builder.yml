name: Build Turnip (Adreno 825)

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to build'
        required: true
        type: string

jobs:
  build_adreno_825:
    runs-on: ubuntu-24.04
    env:
      BUILD_VERSION: ${{ inputs.version }}
      TARGET_GPU: Adreno 825
    steps:
      - uses: actions/checkout@v4

      - name: Prepare environment
        run: |
          sudo sed -i 's/^Types: deb$/Types: deb deb-src/' /etc/apt/sources.list.d/ubuntu.sources
          sudo apt update
          sudo apt install -y build-essential flex bison glslang-tools meson-1.5

      - name: Build Turnip package
        run: bash -euo pipefail ./turnip_builder.sh

      - name: Validate generated package
        run: |
          test -f /tmp/a8xx-gen8-V${BUILD_VERSION}.zip

      - name: Release Turnip (Adreno 825)
        uses: softprops/action-gh-release@v2
        with:
          tag_name: adreno825_v${{ inputs.version }}
          name: Turnip Adreno 825 v${{ inputs.version }}
          body: |
            Turnip Vulkan build for **Adreno 825** (V${{ inputs.version }}).
            Built from: https://github.com/bkupaccount/mesa-tu8 (gen8 branch)

            This workflow is intentionally dedicated to a single purpose:
            - Build and publish one AdrenoTools package for Adreno 825.

            Output file:
            - `/tmp/a8xx-gen8-V${{ inputs.version }}.zip`
          files: |
            /tmp/a8xx-gen8-V${{ inputs.version }}.zip
